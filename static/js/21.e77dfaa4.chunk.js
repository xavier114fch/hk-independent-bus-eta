"use strict";(self.webpackChunkhk_independent_bus_eta=self.webpackChunkhk_independent_bus_eta||[]).push([[21],{8747:(e,t,r)=>{r.d(t,{Z:()=>d});var n=r(8310),a=r(1660),s=r(7313),o=r(4511),l=r(4395),i=r(6060),c=r(3135);var u=r(6417);const d=e=>{let{stops:t}=e;const r=(e=>{const{db:{holidays:t,routeList:r,stopList:n,serviceDayMap:a},isVisible:u,refreshInterval:d,isRouteFilter:p}=(0,s.useContext)(i.ZP),h=(0,s.useCallback)((e=>(0,c.HD)(t,e)),[t]),g=(0,s.useMemo)((()=>e.reduce(((e,t)=>{let[r]=t;return"lightRail"===r}),!1)),[e]),b=(0,s.useMemo)((()=>Object.entries(r).reduce(((t,r)=>{let[n,{stops:s,freq:o}]=r;return p&&!(0,c.x4)(n,o,h(new Date),a)||e.forEach((e=>{var r;let[a,o]=e;null===(r=s[a])||void 0===r||r.forEach(((e,r)=>{e===o&&t.push([n,r])}))})),t}),[]).map((e=>e.join("|"))).filter(((e,t,r)=>r.indexOf(e)===t)).map((e=>e.split("|")))),[e,r,p,h,a]),[x,m]=(0,s.useState)([]),{i18n:{language:f}}=(0,o.$)(),v=(0,s.useRef)(!1),C=(0,s.useCallback)((()=>u&&"prerendering"!==navigator.userAgent?Promise.all(b.map((e=>{let[t,a]=e;return(0,l.Gx)({...r[t],seq:parseInt(a,10),stopList:n,language:f})}))).then((e=>{v.current&&m(e.map(((e,t)=>[b[t].join("/"),e.filter((e=>{let{co:n,dest:a}=e;return"mtr"!==n||a.zh===r[b[t][0]].dest.zh}))])).sort(((e,t)=>{let[r,n]=e,[a,s]=t;return 0===n.length?1:0===s.length?-1:g?n[0].remark.zh===s[0].remark.zh?n[0].eta<s[0].eta?-1:1:n[0].remark.zh<s[0].remark.zh?-1:1:n[0].eta===s[0].eta?r<a?-1:1:n[0].eta<s[0].eta?-1:1})))})):(m([]),new Promise((e=>e([]))))),[u,f,r,n,b,g]);return(0,s.useEffect)((()=>{v.current=!0;const e=setInterval((()=>{C()}),d);return C(),()=>{v.current=!1,clearInterval(e)}}),[C,d]),x})(t);return(0,u.jsx)(n.Z,{children:r.map((e=>{let[t,r]=e;return(0,u.jsx)(a.Z,{routeId:t,etas:r},t)}))})}},5439:(e,t,r)=>{r.d(t,{Z:()=>c});r(7313);var n=r(501),a=r(1113),s=r(4511),o=r(2286),l=r(7822),i=r(6417);const c=()=>{const{t:e}=(0,s.$)(),t=(0,o.GE)();return"prerendering"!==navigator.userAgent&&t&&(t.WTCSGNL&&u.includes(t.WTCSGNL.code)||t.WRAIN&&d.includes(t.WRAIN.code))?(0,i.jsxs)(n.Z,{variant:"outlined",sx:p,onClick:()=>window.open(e("bad-weather-link"),"_target"),children:[(0,i.jsx)(l.Z,{color:"error"}),(0,i.jsx)(a.Z,{children:e("bad-weather-text")})]}):null},u=["TC8NE","TC8SE","TC8NW","TC8SW","TC9","TC10"],d=["WARINR","WRAINB"],p={borderRadius:e=>e.shape.borderRadius,cursor:"pointer",px:2,py:1,display:"flex",alignItems:"center",textAlign:"left",gap:1}},9004:(e,t,r)=>{r.d(t,{Z:()=>d});var n=r(7313),a=r(3428),s=r(4183),o=r(3405),l=r(1113),i=r(4511),c=r(6060),u=r(6417);const d=()=>{const{t:e}=(0,i.$)(),{db:{updateTime:t},renewDb:r}=(0,n.useContext)(c.ZP),d=(0,n.useMemo)((()=>Date.now()>t+24192e5),[t]);return"prerendering"!==navigator.userAgent&&d?(0,u.jsx)(a.Z,{variant:"outlined",sx:p,onClick:r,children:(0,u.jsx)(s.Z,{children:(0,u.jsx)(o.Z,{children:(0,u.jsx)(l.Z,{children:e("db-renew-text")})})})}):null},p={borderRadius:e=>e.shape.borderRadius,margin:.2,height:"100%",display:"flex"}},6021:(e,t,r)=>{r.r(t),r.d(t,{default:()=>v});var n=r(7313),a=r(6060),s=r(501),o=r(7829),l=r(5439),i=r(9004),c=r(1113),u=r(8485),d=r(5280),p=r(4511),h=r(6417);const g=e=>{let{stopTab:t,onChangeTab:r}=e;const{t:s,i18n:{language:o}}=(0,p.$)(),{db:{stopList:l},savedStops:i}=(0,n.useContext)(a.ZP);return 0===i.length?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(c.Z,{variant:"h6",children:s("\u672a\u6709\u6536\u85cf\u8eca\u7ad9")}),(0,h.jsx)(c.Z,{variant:"body1",children:s("\u8acb\u6309\u4e0b\u5716\u6307\u793a\u589e\u52a0")})]}):(0,h.jsx)(u.Z,{value:t,onChange:(e,t)=>r(t,!0),sx:b,variant:"scrollable",scrollButtons:!0,children:i.map((e=>e.split("|"))).filter((e=>{let[t,r]=e;return l[r]})).map(((e,t)=>{let[r,n]=e;return(0,h.jsx)(d.Z,{label:l[n].name[o],value:"".concat(r,"|").concat(n),disableRipple:!0},"stops-".concat(n))}))})},b={background:e=>e.palette.background.default,minHeight:"36px","& .MuiTab-root":{alignItems:"center",justifyContent:"center",paddingTop:0,paddingBottom:0,minHeight:"32px","&.Mui-selected":{color:e=>"dark"===e.palette.mode?e.palette.primary.main:"black"}},"& .MuiTabs-flexContainer":{justifyContent:"flex-start"},"& .MuiTabs-indicator":{backgroundColor:e=>"dark"===e.palette.mode?e.palette.primary.main:"black"}};var x=r(2547),m=r(8747);const f=n.forwardRef(((e,t)=>{let{stopTab:r,onChangeTab:s}=e;const{db:{stopList:o,stopMap:l},savedStops:i}=(0,n.useContext)(a.ZP),c=(0,n.useRef)(r);(0,n.useImperativeHandle)(t,(()=>({changeTab:e=>{c.current=e}})));const u=(0,n.useMemo)((()=>i.filter((e=>e.split("|")[1]in o))),[i,o]),d=(0,n.useCallback)((()=>{let e=u.indexOf(c.current);return-1!==e?e:-1}),[u]),p=(0,n.useMemo)((()=>u.map((e=>{var t;if(""===e)return[];const r=[e.split("|")];return null===(t=l[r[0][1]])||void 0===t||t.forEach((e=>r.push(e))),r}))),[u,l]);return(0,n.useMemo)((()=>(0,h.jsx)(x.ZP,{index:d(),onChangeIndex:e=>{s(u[e])},children:p.map(((e,t)=>(0,h.jsx)(m.Z,{stops:e},"savedStops-".concat(t))))})),[s,d,p,u])})),v=()=>{const{savedStops:e,db:{stopList:t},colorMode:r}=(0,n.useContext)(a.ZP),{i18n:{language:c}}=(0,p.$)(),u=(0,n.useRef)(null),d=(0,n.useMemo)((()=>{try{var r;const n=null!==(r=localStorage.getItem("stopTab"))&&void 0!==r?r:"|";if(n&&e.includes(n)&&t[n.split("|")[1]])return n;for(let r=0;r<e.length;++r){let n=e[r].split("|")[1];if(t[n])return e[r]}}catch(n){console.error(n)}return""}),[e,t]),[b,x]=(0,n.useState)(d),m=(0,n.useCallback)((e=>""===b?"unset":"dark"===e.palette.mode?e.palette.background.default:"white"),[b]);(0,n.useEffect)((()=>{localStorage.setItem("stopTab",b)}),[b]);const v=(0,n.useCallback)((e=>{var t;x(e),null===(t=u.current)||void 0===t||t.changeTab(e)}),[]);return(0,h.jsxs)(s.Z,{sx:{...C,bgcolor:m,backgroundImage:""===b?"url(/stop-bookmark-guide-".concat(r,"-").concat(c,".png)"):"unset",opacity:""===b?"0.8":"unset"},square:!0,elevation:0,children:[(0,h.jsx)(g,{stopTab:b,onChangeTab:v}),(0,h.jsx)(l.Z,{}),(0,h.jsx)(i.Z,{}),(0,h.jsx)(o.Z,{sx:{flex:1,overflow:"scroll"},children:(0,h.jsx)(f,{ref:u,stopTab:b,onChangeTab:e=>x(e)})})]})},C={textAlign:"center",display:"flex",flexDirection:"column",overflow:"auto",width:"100%",flex:1,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat"}},3135:(e,t,r)=>{r.d(t,{HD:()=>a,x4:()=>s});const n=(e,t)=>{let r=24*e*60;return r+=60*parseInt(t.slice(0,2),10)+parseInt(t.slice(2),10),r},a=(e,t)=>e.includes("".concat(t.getFullYear()).concat(("0"+(t.getMonth()+1)).slice(-2)).concat(("0"+t.getDate()).slice(-2))),s=(e,t,r,a)=>{if(!t)return!0;let s=!1,o=new Date;o.setTime(o.getTime()+288e5);let l=n(r?0:o.getUTCDay(),("0"+o.getUTCHours()).slice(-2)+("0"+o.getUTCMinutes()).slice(-2));return Object.entries(t).forEach((t=>{let[r,o]=t;try{a[r].forEach(((e,t)=>{e&&Object.entries(o).forEach((e=>{let[r,a]=e,o=n(t,r),i=n(t,a?a[0]:r);var c,u,d;s=s||(u=i,(c=o)-60<=(d=l)&&d<=u+60||c-60<=d+10080&&d+10080<=u+60)}))}))}catch(i){console.log(e+" has unknown service ID"),s=!0}})),s}},7822:(e,t,r)=>{var n=r(4836);t.Z=void 0;var a=n(r(5045)),s=r(6417),o=(0,a.default)((0,s.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");t.Z=o}}]);