"use strict";(self.webpackChunkhk_independent_bus_eta=self.webpackChunkhk_independent_bus_eta||[]).push([[516],{5516:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ue});var r=n(7313),a=n(6060),s=n(7829),i=n(9099),l=n(9019),o=n(2720),c=n(1479),d=n(9563),u=n(6417);const h=e=>{let{k:t,handleClick:n,disabled:r=!1,sx:a}=e;return(0,u.jsx)(i.Z,{size:"large",variant:"contained",sx:{...m,...a},onClick:()=>n(t),disabled:r,disableRipple:!0,children:"b"===t?(0,u.jsx)(o.Z,{}):"c"===t?(0,u.jsx)(c.Z,{}):t})},x=e=>{let{possibleChar:t}=e;const{numPadOrder:n,searchRoute:s,updateSearchRouteByButton:i}=(0,r.useContext)(a.ZP);return(0,u.jsx)(l.ZP,{container:!0,spacing:0,children:n.split("").map((e=>(0,u.jsx)(l.ZP,{item:!0,xs:4,children:(0,u.jsx)(h,{k:e,handleClick:i,sx:j,disabled:"b"===e&&""===s||!"bc".includes(e)&&!t.includes(e)||"c"===e&&""===s})},"input-"+e)))})},p=e=>{let{possibleChar:t}=e;const{updateSearchRouteByButton:n}=(0,r.useContext)(a.ZP);return(0,u.jsx)(l.ZP,{container:!0,spacing:1,children:t.filter((e=>isNaN(parseInt(e,10)))).map((e=>(0,u.jsx)(l.ZP,{item:!0,xs:6,children:(0,u.jsx)(h,{k:e,handleClick:n,sx:f})},"input-"+e)))})},g=e=>{let{boardTab:t}=e;const{searchRoute:n,db:{routeList:i}}=(0,r.useContext)(a.ZP),l=v(n,i,t);return"prerendering"===navigator.userAgent?(0,u.jsx)(u.Fragment,{}):(0,u.jsxs)(s.Z,{sx:b,padding:0,children:[(0,u.jsx)(s.Z,{sx:Z,padding:0,children:(0,u.jsx)(x,{possibleChar:l})}),(0,u.jsx)(s.Z,{sx:C,padding:0,children:(0,u.jsx)(p,{possibleChar:l})})]})},b={zIndex:0,background:e=>e.palette.background.default,display:"flex",flexDirection:"row",height:"248px",justifyContent:"space-around"},m={background:e=>e.palette.background.paper,color:e=>e.palette.text.primary,width:"100%",fontSize:"1.8em",borderRadius:"unset","&:selected":{color:e=>e.palette.text.primary},"&:hover":{backgroundColor:e=>e.palette.background.paper}},j={height:"62px"},f={height:"52px"},C={width:"35%",height:"246px",overflowX:"hidden",overflowY:"scroll"},Z={width:"62%"},v=(e,t,n)=>{if(null==t)return[];let r={};return Object.entries(t).forEach((t=>{let[a,s]=t;if(a.startsWith(e.toUpperCase())&&s.co.some((e=>d.nR[n].includes(e)))){let t=a.slice(e.length,e.length+1);r[t]=isNaN(r[t])?1:r[t]+1}})),Object.entries(r).map((e=>e[0])).filter((e=>"-"!==e))};var y=n(4511),k=n(5823),w=n(8485),S=n(5280);const T=e=>{let{boardTab:t,onChangeTab:n}=e;const{t:i}=(0,y.$)(),{isRecentSearchShown:l}=(0,r.useContext)(a.ZP);return(0,u.jsx)(s.Z,{sx:D,children:(0,u.jsx)(w.Z,{value:t,onChange:(e,t)=>n(t,!0),sx:R,children:Object.keys(d.nR).filter((e=>l||"recent"!==e)).map((e=>(0,u.jsx)(S.Z,{label:i(e),value:e,disableRipple:!0},e)))})})},R={background:e=>e.palette.background.default,minHeight:"36px",overflow:"auto",maxWidth:"100%","& .MuiTab-root":{py:0,minWidth:"85px",minHeight:"32px","&.Mui-selected":{color:e=>"dark"===e.palette.mode?e.palette.primary.main:"black"},"&.MuiButtonBase-root":{textTransform:"none"}},"& .MuiTabs-indicator":{backgroundColor:e=>"dark"===e.palette.mode?e.palette.primary.main:"black"},"& .MuiTabs-scroller":{overflow:"auto !important"}},D={background:e=>"dark"===e.palette.mode?e.palette.background.default:"white"};var I=n(2547),M=n(275),P=n(2429),O=n(3165),B=n(8566),F=n(6912),L=n(1113),z=n(3135),H=n(3428),$=n(4183),U=n(3405),E=n(7131),N=n(2135);const W=e=>{let{terminus:t}=e;const{t:n,i18n:r}=(0,y.$)();return(0,u.jsxs)(s.Z,{sx:_,children:[(0,u.jsxs)(s.Z,{sx:A,children:[(0,u.jsx)("span",{children:"".concat(n("\u5f80")," ")}),(0,u.jsx)(L.Z,{component:"h3",variant:"h6",sx:X,children:(0,k.iF)(t.dest[r.language])})]}),(0,u.jsx)(s.Z,{sx:Y,children:(0,u.jsx)(L.Z,{variant:"body2",children:(0,k.iF)(t.orig[r.language])})})]})},_={textAlign:"left","& > span":{}},A={display:"flex",alignItems:"baseline",whiteSpace:"nowrap",overflowX:"hidden","& > span":{fontSize:"0.95em",mr:.5}},Y={display:"flex",alignItems:"baseline",whiteSpace:"nowrap",overflowX:"hidden"},X={fontWeight:700};var q=n(9530);const G=e=>{let{route:t}=e;const{t:n}=(0,y.$)(),[r,a]=t[0].split("-").slice(0,2);return(0,u.jsxs)(s.Z,{children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(q.Z,{routeNo:r}),parseInt(a,10)>=2&&(0,u.jsx)(L.Z,{variant:"caption",sx:K,children:n("\u7279\u5225\u73ed")})]}),(0,u.jsx)(L.Z,{component:"h4",variant:"caption",sx:J,children:t[1].co.map((e=>n(e))).join("+")})]})},J={color:e=>e.palette.text.secondary},K={fontSize:"0.6rem",marginLeft:"8px"};var Q=n(8586);const V=e=>{let{route:t,handleClick:n,style:r,onRemove:a}=e;const{i18n:s}=(0,y.$)();return(0,u.jsx)(N.rU,{to:"/".concat(s.language,"/route/").concat(t[0].toLowerCase()),style:r,children:(0,u.jsxs)(H.Z,{variant:"outlined",square:!0,sx:ee,children:[(0,u.jsx)($.Z,{onClick:n,children:(0,u.jsxs)(U.Z,{sx:te,children:[(0,u.jsx)(G,{route:t}),(0,u.jsx)(W,{terminus:t[1]})]})}),null!==a&&(0,u.jsx)(E.Z,{onClick:a,children:(0,u.jsx)(Q.Z,{})})]},t[0])})},ee={border:"none",display:"flex",alignItems:"center"},te={display:"grid",gridTemplateColumns:"25% 65%",py:.5,px:2,alignItems:"center"};var ne=n(8467);const re=r.memo((e=>{let{data:{routeList:t,vibrateDuration:n,tab:s},index:i,style:l}=e;const o=t[i],{addSearchHistory:c,removeSearchHistoryByRouteId:d}=(0,r.useContext)(a.ZP),{i18n:h}=(0,y.$)(),x=(0,ne.s0)();return(0,u.jsx)(V,{handleClick:e=>{e.preventDefault(),(0,k.tp)(n),c(o[0]),setTimeout((()=>{x("/".concat(h.language,"/route/").concat(o[0].toLowerCase()))}),0)},route:o,style:l,onRemove:"recent"===s?e=>{e.preventDefault(),(0,k.tp)(n),d(o[0])}:null})}),O.wy),ae=(0,F.Z)(((e,t,n)=>({routeList:e,vibrateDuration:t,tab:n}))),se=(0,M.yP)((0,M.p6)(I.ZP)),ie=e=>{let{boardTab:t,onChangeTab:n}=e;const{searchRoute:i,db:{holidays:l,routeList:o,serviceDayMap:c},isRouteFilter:h,busSortOrder:x,routeSearchHistory:p,vibrateDuration:g,isRecentSearchShown:b}=(0,r.useContext)(a.ZP),m=(0,r.useMemo)((()=>(0,z.HD)(l,new Date)),[l]),{t:j}=(0,y.$)(),f=(0,r.useMemo)((()=>{const e=Object.entries(o).filter((e=>{let[t,{stops:n,co:r}]=e;return t.startsWith(i.toUpperCase())&&(null==n[r[0]]||n[r[0]].length>0)})).filter((e=>{let[t,{freq:n}]=e;return!h||(0,z.x4)(t,n,m,c)})).sort(((e,t)=>(0,k.nO)(e,t,d.Y$[x])));return Object.entries(d.nR).filter((e=>{let[t]=e;return b||"recent"!==t})).map(((t,n)=>{let[r,a]=t;return ae("recent"===r?p.filter((e=>e.startsWith(i.toUpperCase()))).filter((e=>o[e])).map((e=>[e,o[e]])):e.filter((e=>{let[t,{co:n}]=e;return n.some((e=>a.includes(e)))})),g,r)}))}),[o,m,i,h,g,x,p,b,c]),C=(0,r.useMemo)((()=>{const e=parseInt(getComputedStyle(document.body).fontSize,10);return e<=18?64:e<=22?78:e<=26?92:e<=30?98:110}),[]),Z=(0,r.useCallback)((e=>{let{key:t,index:n}=e;return(0,u.jsx)(r.Fragment,{children:f[n].routeList.length>0?(0,u.jsx)(B.Z,{children:e=>{let{height:t,width:r}=e;return(0,u.jsx)(O.t7,{height:.98*t,itemCount:f[n].routeList.length,itemSize:C,width:r,itemData:f[n],children:re})}}):(0,u.jsxs)(s.Z,{sx:ce,children:[(0,u.jsx)(P.Z,{fontSize:"small"}),(0,u.jsx)(s.Z,{children:n>0?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(L.Z,{variant:"h6",children:['"',i,'"']}),(0,u.jsx)(L.Z,{variant:"h6",children:j("route-search-no-result")})]}):(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(L.Z,{variant:"h6",children:j("no-recent-search")})})})]})},t)}),[C,f,i,j]),v=(0,r.useMemo)((()=>le.filter((e=>b||"recent"!==e))),[b]);return(0,r.useMemo)((()=>(0,u.jsx)(u.Fragment,{children:"prerendering"===navigator.userAgent?(0,u.jsx)(s.Z,{sx:oe,children:f[0].routeList.map(((e,t)=>(0,u.jsx)(re,{data:f[0],index:t,style:null},"route-".concat(t))))}):(0,u.jsx)(se,{index:v.indexOf(t),onChangeIndex:e=>{n(v[e])},style:{flex:1,display:"flex"},containerStyle:{flex:1},slideCount:f.length,overscanSlideAfter:1,overscanSlideBefore:1,slideRenderer:Z,enableMouseEvents:!0})})),[Z,f,n,t,v])},le=["recent","all","bus","minibus","lightRail","mtr"],oe={height:"100%",overflowY:"scroll"},ce={height:"140px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center","& .MuiSvgIcon-root":{fontSize:"4em",mr:2}},de=e=>{let{boardTab:t,setBoardTab:n}=e;const{AppTitle:i}=(0,r.useContext)(a.ZP),{t:l,i18n:o}=(0,y.$)();(0,r.useEffect)((()=>{(0,k.ND)({title:l("\u641c\u5c0b")+" - "+l(i),description:l("route-board-page-description"),lang:o.language})}),[o.language]);const c=(0,r.useCallback)((e=>{n(e),localStorage.setItem("boardTab",e)}),[n]);return(0,u.jsxs)(s.Z,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[(0,u.jsx)(T,{boardTab:t,onChangeTab:c}),(0,u.jsx)(ie,{boardTab:t,onChangeTab:c})]})},ue=()=>{const{isRecentSearchShown:e}=(0,r.useContext)(a.ZP),t=localStorage.getItem("boardTab"),[n,s]=(0,r.useState)(((e,t)=>t&&"recent"===e||"all"===e||"bus"===e||"minibus"===e||"lightRail"===e||"mtr"===e)(t,e)?t:"all");return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(de,{boardTab:n,setBoardTab:s}),(0,u.jsx)(g,{boardTab:n})]})}},3135:(e,t,n)=>{n.d(t,{HD:()=>a,x4:()=>s});const r=(e,t)=>{let n=24*e*60;return n+=60*parseInt(t.slice(0,2),10)+parseInt(t.slice(2),10),n},a=(e,t)=>e.includes("".concat(t.getFullYear()).concat(("0"+(t.getMonth()+1)).slice(-2)).concat(("0"+t.getDate()).slice(-2))),s=(e,t,n,a)=>{if(!t)return!0;let s=!1,i=new Date;i.setTime(i.getTime()+288e5);let l=r(n?0:i.getUTCDay(),("0"+i.getUTCHours()).slice(-2)+("0"+i.getUTCMinutes()).slice(-2));return Object.entries(t).forEach((t=>{let[n,i]=t;try{a[n].forEach(((e,t)=>{e&&Object.entries(i).forEach((e=>{let[n,a]=e,i=r(t,n),o=r(t,a?a[0]:n);var c,d,u;s=s||(d=o,(c=i)-60<=(u=l)&&u<=d+60||c-60<=u+10080&&u+10080<=d+60)}))}))}catch(o){console.log(e+" has unknown service ID"),s=!0}})),s}}}]);