"use strict";(self.webpackChunkhk_independent_bus_eta=self.webpackChunkhk_independent_bus_eta||[]).push([[742],{1268:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(7829),r=n(5309),c=n(9980),a=n(7313),s=n(6060),l=n(6417);const i=()=>{const{compassPermission:e,setCompassPermission:t}=(0,a.useContext)(s.ZP),n=(0,a.useCallback)((()=>{(0,c.ZK)().then((e=>{t(e)}))}),[t]);return c.G6&&"granted"!==e?(0,l.jsx)("div",{className:"leaflet-bottom leaflet-right",children:(0,l.jsx)(o.Z,{sx:u,className:"leaflet-control leaflet-bar",onClick:n,children:(0,l.jsx)(r.Z,{sx:{p:"3px",color:"black"}})})}):(0,l.jsx)(l.Fragment,{})},u={background:"white",width:32,height:32,marginBottom:"57px !important",marginRight:"5px !important",display:"flex",justifyContent:"center",alignItems:"center"}},8379:(e,t,n)=>{n.d(t,{Z:()=>p});var o=n(7313),r=n(6060),c=n(5823),a=n(9062),s=n(5594),l=n(7248),i=n.n(l),u=n(9980),d=(n(7686),n(6417));const g=(0,o.forwardRef)(((e,t)=>{let{children:n,...r}=e;const c=(0,o.useRef)(null),s=(0,u.ZP)(100),[l,i]=(0,o.useState)(null);return(0,o.useEffect)((()=>{const e=e=>{try{const t=JSON.parse(e.data);"compass"===(null===t||void 0===t?void 0:t.type)&&i({degree:t.degree,accuracy:t.accuracy})}catch(t){}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}}),[]),(0,o.useEffect)((()=>{i(s)}),[s]),(0,o.useEffect)((()=>{const e=c.current;e&&l&&(e.setRotationAngle(360-l.degree),e.setRotationOrigin("center"))}),[l]),null===l?(0,d.jsx)(d.Fragment,{}):(0,d.jsx)(a.J,{ref:e=>{c.current=e,t&&(t.current=e)},...r,children:n})})),p=()=>{const{geolocation:e,geoPermission:t}=(0,o.useContext)(r.ZP),n=(0,o.useMemo)((()=>f()),[]);return"granted"!==t?null:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.C,{center:(0,c.bf)(e),radius:25}),(0,d.jsx)(g,{rotationOrigin:"center",icon:n,position:(0,c.bf)(e)},"rotated-marker")]})},f=()=>i().divIcon({iconSize:[20,20],iconAnchor:[10,10],className:"self-center"})},6742:(e,t,n)=>{n.r(t),n.d(t,{default:()=>C});var o=n(7313),r=n(9062),c=n(4580),a=n(8153),s=n(9024),l=n(7828),i=n(7096),u=n(7248),d=n.n(u);const g=(0,s.Au)((function(e,t){let{data:n,...o}=e;const r=new u.GeoJSON(n,o);return(0,l.O)(r,(0,i.sj)(t,{overlayContainer:r}))}),(function(e,t,n){t.style!==n.style&&(null==t.style?e.resetStyle():e.setStyle(t.style))}));var p=n(7829),f=n(4511),h=n(6060),m=n(1171),b=n(6417);const k=(0,m.Z)((0,b.jsx)("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"}),"MyLocation");var x=n(5823),v=n(8379),y=n(1268);const j=e=>{let{onClick:t}=e;return(0,b.jsx)("div",{className:"leaflet-bottom leaflet-right",children:(0,b.jsx)(p.Z,{sx:E,className:"leaflet-control leaflet-bar",onClick:t,children:(0,b.jsx)(k,{className:z.centerControl})})})},C=e=>{var t;let{gtfsId:n,bound:s,stops:l,stopIdx:i,onMarkerClick:u}=e;const{geolocation:m,geoPermission:k,updateGeoPermission:C,colorMode:M}=(0,o.useContext)(h.ZP),{i18n:E}=(0,f.$)(),[N,B]=(0,o.useState)(null),I=((e,t,n)=>{const[r,c]=(0,o.useState)(null);return(0,o.useEffect)((()=>(fetch("https://hkbus.github.io/route-waypoints/".concat(e,"-").concat("I"===t?"I":"O",".json")).then((e=>e.json())).then((e=>{c(e)})).catch((()=>{c({features:[{type:"Feature",geometry:{type:"LineString",coordinates:n.reduce(((e,t)=>{let{location:{lat:n,lng:o}}=t;return e.push([o,n]),e}),[])}}],type:"FeatureCollection"})})),()=>{c(null)})),[e,t,n]),r})(n,s,l),S=(0,o.useRef)({initialCenter:l[i]?l[i].location:(0,x.bf)(),currentStopCenter:l[i]?l[i].location:(0,x.bf)(),center:l[i]?l[i].location:(0,x.bf)(),isFollow:!1,stops:l,stopIdx:i});(0,o.useEffect)((()=>{let e,t;e=S.current.stops===l&&S.current.stopIdx===i&&S.current.isFollow,t=S.current.stops===l&&S.current.stopIdx===i&&e?m:l[i]?l[i].location:(0,x.bf)();const n=S.current.center;var o,r;n===t||(0,x.pB)(t,n)||(S.current.stops!==l?null===(o=S.current.map)||void 0===o||o.setView(t):null===(r=S.current.map)||void 0===r||r.flyTo(t));S.current={...S.current,center:t,currentStopCenter:l[i]?l[i].location:(0,x.bf)(),stops:l,stopIdx:i,isFollow:e}}),[l,i,m]),(0,o.useEffect)((()=>{if(N){S.current={...S.current,map:N};const e=()=>{S.current={...S.current,center:S.current.currentStopCenter,isFollow:!1}};return null===N||void 0===N||N.on({dragend:e,dragstart:e}),null===N||void 0===N||N.setView(S.current.center),null===N||void 0===N||N.invalidateSize(),()=>{N.off({dragstart:e,dragend:e})}}}),[N]);const V=(0,o.useCallback)((()=>{var e;"granted"===k?(null===(e=S.current.map)||void 0===e||e.flyTo(m),S.current={...S.current,center:m,isFollow:!0}):"denied"!==k&&(S.current={...S.current,isFollow:!0},C("opening"))}),[k,m,C]),Z=(0,o.useMemo)((()=>l.map(((e,t)=>(0,b.jsx)(r.J,{position:e.location,icon:w({active:t===i,passed:t<i}),alt:"".concat(t,". ").concat(e.name[E.language]),eventHandlers:{click:e=>{u(t,e)}}},"".concat(e.location.lng,"-").concat(e.location.lat,"-").concat(t))))),[E.language,u,i,l]);return(0,b.jsx)(p.Z,{id:"route-map",sx:J,children:(0,b.jsxs)(c.h,{center:S.current.initialCenter,zoom:16,scrollWheelZoom:!1,className:z.mapContainer,ref:B,children:[(0,b.jsx)(a.I,{crossOrigin:"anonymous",maxZoom:d().Browser.retina?20:19,maxNativeZoom:18,keepBuffer:10,updateWhenIdle:!1,attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors \xa9 <a href="https://carto.com/attributions">CARTO</a>',url:"light"===M?"https://cartodb-basemaps-a.global.ssl.fastly.net/rastertiles/voyager/{z}/{x}/{y}{r}.png":"https://cartodb-basemaps-a.global.ssl.fastly.net/light_all/{z}/{x}/{y}{r}.png"}),Z,(null===I||void 0===I||null===(t=I.features)||void 0===t?void 0:t.length)&&(0,b.jsx)(g,{data:I,style:A},null===I||void 0===I?void 0:I.timeStamp),(0,b.jsx)(v.Z,{}),(0,b.jsx)(j,{onClick:V}),(0,b.jsx)(y.Z,{})]})})},A=function(e){return{color:"#FF9090",weight:4}},w=e=>{let{active:t,passed:n}=e;return d().divIcon({iconSize:[25,41],iconAnchor:[12.5,41],className:"".concat(z.marker," ").concat(t?z.active:""," ").concat(n?z.passed:"")})},M="routeMap",z={mapContainerBox:"".concat(M,"-mapContainerBox"),mapContainer:"".concat(M,"-mapContainer"),centerControl:"".concat(M,"-centerControl"),marker:"".concat(M,"-marker"),active:"".concat(M,"-active"),passed:"".concat(M,"-passed")},J={height:"35vh",filter:e=>"dark"===e.palette.mode?"brightness(0.8)":"none",["& .".concat(z.mapContainer)]:{height:"35vh"},["& .".concat(z.marker)]:{width:"25px",height:"41px",zIndex:618,outline:"none",filter:"hue-rotate(130deg)",backgroundImage:"url(".concat("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAMAAAAhFXfZAAAC91BMVEVMaXEzeak2f7I4g7g3g7cua5gzeKg8hJo3grY4g7c3grU0gLI2frE0daAubJc2gbQwd6QzeKk2gLMtd5sxdKIua5g1frA2f7IydaM0e6w2fq41fK01eqo3grgubJgta5cxdKI1f7AydaQydaMxc6EubJgvbJkwcZ4ubZkwcJwubZgubJcydqUydKIxapgubJctbJcubZcubJcvbJYubJcvbZkubJctbJctbZcubJg2f7AubJcrbZcubJcubJcua5g3grY0fq8ubJcubJdEkdEwhsw6i88vhswuhcsuhMtBjMgthMsrg8srgss6is8qgcs8i9A9iMYtg8spgcoogMo7hcMngMonf8olfso4gr8kfck5iM8jfMk4iM8he8k1fro7itAgesk2hs8eecgzfLcofssdeMg0hc4cd8g2hcsxeLQbdsgZdcgxeLImfcszhM0vda4xgckzhM4xg84wf8Yxgs4udKsvfcQucqhUndROmdM1fK0wcZ8vb5w0eqpQm9MzeKhXoNVcpdYydKNWn9VZotVKltJFjsIwcJ1Rms9OlslLmtH///8+kc9epdYzd6dbo9VHkMM2f7FHmNBClM8ydqVcpNY9hro3gLM9hLczealQmcw3fa46f7A8gLMxc6I3eagyc6FIldJMl9JSnNRSntNNl9JPnNJFi75UnM9ZodVKksg8kM45jc09e6ZHltFBk883gbRBh7pDk9EwcaBzn784g7dKkcY2i81Om9M7j85Llc81is09g7Q4grY/j9A0eqxKmdFFltBEjcXf6fFImdBCiLxJl9FGlNFBi78yiMxVndEvbpo6js74+vx+psPP3+o/ks5HkcpGmNCjwdZCkNDM3ehYoNJEls+lxNkxh8xHks0+jdC1zd5Lg6r+/v/H2ufz9/o3jM3t8/edvdM/k89Th61OiLBSjbZklbaTt9BfptdjmL1AicBHj8hGk9FAgK1dkLNTjLRekrdClc/k7fM0icy0y9tgp9c4jc2NtM9Dlc8zicxeXZn3AAAAQ3RSTlMAHDdTb4yPA+LtnEQmC4L2EmHqB7XA0d0sr478x4/Yd5i1zOfyPkf1sLVq4Nh3FvjxopQ2/STNuFzUwFIwxKaejILpIBEV9wAABhVJREFUeF6s1NdyFEcY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",")"),backgroundSize:"cover"},["& .".concat(z.active)]:{animation:"blinker 2s linear infinite"},["& .".concat(z.passed)]:{filter:"grayscale(100%)"},"& .self-center":{backgroundImage:"url(/self.svg)",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",transition:"transform 0.1s ease-out",transformOrigin:"center"}},E={background:"white",width:32,height:32,marginBottom:"20px !important",marginRight:"5px !important",display:"flex",justifyContent:"center",alignItems:"center",["& .".concat(z.centerControl)]:{padding:"3px",color:"black"}}}}]);