(self.webpackChunkhk_independent_bus_eta=self.webpackChunkhk_independent_bus_eta||[]).push([[781],{421:(e,t,n)=>{"use strict";n.d(t,{D:()=>l,u:()=>a});var r=n(7313),o=n(9176),i=n(5281),s=n(6417);const a=r.forwardRef(((e,t)=>{let{sx:n,color:r,...i}=e;return(0,s.jsx)(o.Z,{color:null!==r&&void 0!==r?r:"inherit",sx:{m:1,height:5,borderRadius:5,...n},ref:t,...i})})),l=r.forwardRef(((e,t)=>{let{sx:n,color:r,...o}=e;return(0,s.jsx)(i.Z,{color:null!==r&&void 0!==r?r:"inherit",sx:{m:1,...n},ref:t,...o})}))},5439:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});n(7313);var r=n(501),o=n(1113),i=n(4511),s=n(2286),a=n(7822),l=n(6417);const c=()=>{const{t:e}=(0,i.$)(),t=(0,s.GE)();return"prerendering"!==navigator.userAgent&&t&&(t.WTCSGNL&&u.includes(t.WTCSGNL.code)||t.WRAIN&&d.includes(t.WRAIN.code))?(0,l.jsxs)(r.Z,{variant:"outlined",sx:p,onClick:()=>window.open(e("bad-weather-link"),"_target"),children:[(0,l.jsx)(a.Z,{color:"error"}),(0,l.jsx)(o.Z,{children:e("bad-weather-text")})]}):null},u=["TC8NE","TC8SE","TC8NW","TC8SW","TC9","TC10"],d=["WARINR","WRAINB"],p={borderRadius:e=>e.shape.borderRadius,cursor:"pointer",px:2,py:1,display:"flex",alignItems:"center",textAlign:"left",gap:1}},9004:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(7313),o=n(3428),i=n(4183),s=n(3405),a=n(1113),l=n(4511),c=n(6060),u=n(6417);const d=()=>{const{t:e}=(0,l.$)(),{db:{updateTime:t},renewDb:n}=(0,r.useContext)(c.ZP),d=(0,r.useMemo)((()=>Date.now()>t+24192e5),[t]);return"prerendering"!==navigator.userAgent&&d?(0,u.jsx)(o.Z,{variant:"outlined",sx:p,onClick:n,children:(0,u.jsx)(i.Z,{children:(0,u.jsx)(s.Z,{children:(0,u.jsx)(a.Z,{children:e("db-renew-text")})})})}):null},p={borderRadius:e=>e.shape.borderRadius,margin:.2,height:"100%",display:"flex"}},4781:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>P});var r=n(7313),o=n(501),i=n(1113),s=n(282),a=n(4511),l=n(6060),c=n(5823),u=n(2061),d=n.n(u),p=n(8485),f=n(5280),x=n(1171),h=n(6417);const g=(0,x.Z)([(0,h.jsx)("circle",{cx:"12",cy:"17",r:"4"},"0"),(0,h.jsx)("path",{d:"M12 10.07c1.95 0 3.72.79 5 2.07l5-5C19.44 4.59 15.9 3 12 3S4.56 4.59 2 7.15l5 5c1.28-1.28 3.05-2.08 5-2.08z"},"1")],"CompassCalibration");var m=n(6584),b=n(7943);const v=e=>{let{homeTab:t,onChangeTab:n}=e;const{t:o}=(0,a.$)(),{collections:i}=(0,r.useContext)(l.ZP);return(0,h.jsxs)(p.Z,{value:t,onChange:(e,t)=>n(t,!0),sx:j,variant:"scrollable",scrollButtons:!0,children:[(0,h.jsx)(f.Z,{iconPosition:"start",icon:(0,h.jsx)(g,{}),label:o("\u9644\u8fd1"),value:"nearby",disableRipple:!0}),(0,h.jsx)(f.Z,{iconPosition:"start",icon:(0,h.jsx)(m.Z,{}),label:o("\u5e38\u7528"),value:"saved",disableRipple:!0}),(0,h.jsx)(f.Z,{iconPosition:"start",icon:(0,h.jsx)(b.Z,{}),label:o("Collections"),value:"collections",disableRipple:!0}),i.map(((e,t)=>(0,h.jsx)(f.Z,{label:e.name,value:e.name,disableRipple:!0},"collection-".concat(t))))]})},j={background:e=>e.palette.background.default,minHeight:"36px","& .MuiTab-root":{textTransform:"none",alignItems:"center",justifyContent:"center",paddingTop:0,paddingBottom:0,minHeight:"32px","&.Mui-selected":{color:e=>"dark"===e.palette.mode?e.palette.primary.main:"black"}},"& .MuiTabs-flexContainer":{justifyContent:"flex-start"},"& .MuiTabs-indicator":{backgroundColor:e=>"dark"===e.palette.mode?e.palette.primary.main:"black"}};var y=n(5439),Z=n(2547),T=n(8310),C=n(7829),w=n(3135),M=n(1660),R=n(421),D=n(9536);const E=(0,x.Z)((0,h.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),k=(0,x.Z)((0,h.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess"),S=e=>{let{name:t,routeStrings:n,defaultExpanded:o=!0}=e;const[s,a]=(0,r.useState)(o),l=(0,r.useMemo)((()=>{var e;return null!==(e=n.split("|").filter((e=>e)))&&void 0!==e?e:[]}),[n]);return 0===l.length?(0,h.jsx)(h.Fragment,{}):(0,h.jsxs)(C.Z,{children:[(0,h.jsxs)(C.Z,{sx:O,onClick:()=>a((e=>!e)),children:[(0,h.jsx)(i.Z,{variant:"body1",m:1,fontWeight:700,children:t}),(0,h.jsx)(C.Z,{children:s?(0,h.jsx)(k,{}):(0,h.jsx)(E,{})})]}),(0,h.jsx)(D.Z,{}),s&&(0,h.jsx)(T.Z,{disablePadding:!0,children:l.map(((e,n)=>Boolean(e)&&(0,h.jsx)(M.Z,{routeId:e},"route-".concat(t,"-").concat(n))))}),(0,h.jsx)(D.Z,{})]})},O={display:"flex",alignItems:"center",justifyContent:"space-between",mx:1,cursor:"pointer"},I=r.forwardRef(((e,t)=>{let{geolocation:n,homeTab:o,onChangeTab:s}=e;const{savedEtas:c,db:{holidays:u,routeList:d,stopList:p,serviceDayMap:f},isRouteFilter:x,collections:g}=(0,r.useContext)(l.ZP),m=(0,r.useMemo)((()=>(0,w.HD)(u,new Date)),[u]),b=(0,r.useRef)(o),{t:v}=(0,a.$)(),[j,y]=(0,r.useState)(null);(0,r.useImperativeHandle)(t,(()=>({changeTab:e=>{b.current=e}}))),(0,r.useEffect)((()=>{y(L({geolocation:n,savedEtas:c,collections:g,routeList:d,stopList:p,isRouteFilter:x,isTodayHoliday:m,serviceDayMap:f}))}),[n,c,g,d,p,x,m,f]);const D=(0,r.useMemo)((()=>{if(null===j)return(0,h.jsx)(R.D,{sx:{my:10}});const e=j.saved.split("|"),t=e.every((e=>!e));return(0,h.jsx)(r.Fragment,{children:t?(0,h.jsx)(i.Z,{sx:{marginTop:5},children:(0,h.jsx)("b",{children:v("\u672a\u6709\u6536\u85cf\u8def\u7dda")})}):(0,h.jsx)(T.Z,{disablePadding:!0,children:e.map(((e,t)=>Boolean(e)&&(0,h.jsx)(M.Z,{routeId:e},"route-shortcut-".concat(t))))})})}),[j,v]),E=(0,r.useMemo)((()=>null!==j&&void 0!==j&&j.nearby?(0,h.jsx)(C.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:Object.entries(j.nearby).map((e=>{let[t,n]=e;return(0,h.jsx)(S,{name:v(t),routeStrings:n},"nearby-".concat(t))}))}):(0,h.jsx)(R.D,{sx:{my:10}})),[j,v]),k=(0,r.useMemo)((()=>(null===j||void 0===j?void 0:j.smartCollections.length)>0?(0,h.jsxs)(C.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[j.smartCollections.map(((e,t)=>{let{name:n,routes:r,defaultExpanded:o}=e;return(0,h.jsx)(S,{name:n,routeStrings:r,defaultExpanded:o},"collection-".concat(t))})),!j.smartCollections.reduce(((e,t)=>{let{routes:n}=t;return e||n.split("|").filter((e=>Boolean(e))).length>0}),!1)&&(0,h.jsx)(i.Z,{sx:{marginTop:5},fontWeight:700,children:v("\u672a\u6709\u6536\u85cf\u8def\u7dda")})]}):(0,h.jsx)(i.Z,{sx:{marginTop:5},fontWeight:700,children:v("\u672a\u6709\u6536\u85cf\u8def\u7dda")})),[v,j]),O=(0,r.useMemo)((()=>g.map(((e,t)=>{var n;const o=null!==(n=null===j||void 0===j?void 0:j.collections[t].split("|"))&&void 0!==n?n:[],s=o.every((e=>!e));return(0,h.jsx)(r.Fragment,{children:s?(0,h.jsx)(i.Z,{sx:{marginTop:5},children:(0,h.jsx)("b",{children:v("\u6536\u85cf\u4e2d\u672a\u6709\u8def\u7dda")})}):(0,h.jsx)(T.Z,{disablePadding:!0,children:o.map(((e,t)=>Boolean(e)&&(0,h.jsx)(M.Z,{routeId:e},"route-shortcut-".concat(t))))})},"collection-route-".concat(t))}))),[v,g,j]),I=(0,r.useCallback)((()=>{let e=N.indexOf(b.current);if(-1!==e)return e;for(let t=0;t<g.length;++t)if(g[t].name===b.current)return t+N.length;return-1}),[g]);return(0,r.useMemo)((()=>(0,h.jsxs)(Z.ZP,{index:I(),onChangeIndex:e=>{s(e<N.length?N[e]:g[e-N.length].name)},children:[E,D,k,null===O||void 0===O?void 0:O.map((e=>e))]})),[s,I,g,D,E,k,O])})),N=["nearby","saved","collections"],L=e=>{let{savedEtas:t,collections:n,geolocation:r,stopList:o,routeList:i,isRouteFilter:s,isTodayHoliday:a,serviceDayMap:l}=e;const u=t.filter(((e,t,n)=>n.indexOf(e)===t&&e.split("/")[0]in i)).map(((e,t,n)=>{const[s,a]=e.split("/"),l=Object.values(i[s].stops).sort(((e,t)=>t.length-e.length))[0];if(void 0!==a)return[e,(0,c.Sp)(r,o[l[a]].location),n.length-t];{const i=l.map((e=>[e,(0,c.Sp)(r,o[e].location)])).sort(((e,t)=>{let[,n]=e,[,r]=t;return n<r?-1:1}))[0][0];return[e,(0,c.Sp)(r,o[i].location),n.length-t]}})),d=Object.entries(o).map((e=>[...e,(0,c.Sp)(e[1].location,r)])).filter((e=>e[2]<1e3)).sort(((e,t)=>e[2]-t[2])).slice(0,20).reduce(((e,t)=>{let[n]=t;return Object.entries(i).forEach((t=>{let[r,o]=t;["kmb","lrtfeeder","lightRail","gmb","ctb","nlb"].forEach((t=>{o.stops[t]&&o.stops[t].includes(n)&&(void 0===e[c.TN[t]]&&(e[c.TN[t]]=[]),e[c.TN[t]].push(r+"/"+o.stops[t].indexOf(n)))}))})),e}),{bus:[],mtr:[],lightRail:[],minibus:[]}),p=n.reduce(((e,t)=>{let{name:n,list:r,schedules:o}=t;return e.push({name:n,routes:r,defaultExpanded:o.reduce(((e,t)=>{let{day:n,start:r,end:o}=t;if(e)return e;const i=new Date;i.setUTCHours(i.getUTCHours()+8);const s=i.getUTCDay();if(a&&0===n||n===s){let e=60*r.hour+r.minute,t=60*o.hour+o.minute,n=(60*i.getUTCHours()+i.getUTCMinutes())%1440;return e<=n&&n<=t}return!1}),!1)}),e}),[]),f=e=>e.filter(((e,t,n)=>n.indexOf(e)===t)).filter((e=>{const[t]=e.split("/");return i[t]&&(!s||(0,w.x4)(t,i[t].freq,a,l))})).map((e=>{const[t,n]=e.split("/");if(void 0!==n)return e;const s=Object.values(i[t].stops).sort(((e,t)=>t.length-e.length))[0],a=s.map((e=>[e,(0,c.Sp)(r,o[e].location)])).sort(((e,t)=>{let[,n]=e,[,r]=t;return n<r?-1:1}))[0][0];return"".concat(e,"/").concat(s.indexOf(a))})).concat(Array(40).fill("")).slice(0,40).join("|");return{saved:f(u.sort(((e,t)=>e[2]-t[2])).map((e=>e[0])).slice(0,40)),nearby:Object.entries(d).reduce(((e,t)=>{let[n,r]=t;return e[n]=f(r),e}),{}),smartCollections:p.map((e=>({...e,routes:f(e.routes)}))),collections:n.map((e=>f(e.list)))}};var W=n(9004),H=n(8467);const P=()=>{const{AppTitle:e,geolocation:t,collections:n}=(0,r.useContext)(l.ZP),{t:u,i18n:p}=(0,a.$)(),{collectionName:f}=(0,H.UO)(),x=(0,r.useRef)(null),g=null!==f&&void 0!==f?f:localStorage.getItem("homeTab"),[m,b]=(0,r.useState)(((e,t)=>{if("saved"===e||"nearby"===e||"collections"===e)return!0;for(let n=0;n<t.length;++n)if(e===t[n].name)return!0;return!1})(g,n)?g:"nearby");(0,r.useEffect)((()=>{(0,c.ND)({title:"".concat(u("Dashboard")," - ").concat(u(e)),description:u("home-page-description"),lang:p.language})}),[p.language]);const[j,Z]=(0,r.useState)(t),T=(0,r.useRef)(d()((()=>{Z(t)}),1e3)).current;(0,r.useEffect)((()=>{T(t)}),[t]);const C=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];b(e),localStorage.setItem("homeTab",e),x.current&&t&&x.current.changeTab(e)};return(0,h.jsxs)(o.Z,{sx:A,square:!0,elevation:0,children:[(0,h.jsx)(i.Z,{component:"h1",style:s.Z,children:"".concat(u("Dashboard")," - ").concat(u(e))}),(0,h.jsx)(i.Z,{component:"h2",style:s.Z,children:u("home-page-description")}),(0,h.jsx)(v,{homeTab:m,onChangeTab:C}),(0,h.jsx)(y.Z,{}),(0,h.jsx)(W.Z,{}),(0,h.jsx)(I,{ref:x,homeTab:m,geolocation:j,onChangeTab:C})]})},A={background:e=>"dark"===e.palette.mode?e.palette.background.default:"white",textAlign:"center",display:"flex",flexDirection:"column",overflow:"auto",width:"100%"}},3135:(e,t,n)=>{"use strict";n.d(t,{HD:()=>o,x4:()=>i});const r=(e,t)=>{let n=24*e*60;return n+=60*parseInt(t.slice(0,2),10)+parseInt(t.slice(2),10),n},o=(e,t)=>e.includes("".concat(t.getFullYear()).concat(("0"+(t.getMonth()+1)).slice(-2)).concat(("0"+t.getDate()).slice(-2))),i=(e,t,n,o)=>{if(!t)return!0;let i=!1,s=new Date;s.setTime(s.getTime()+288e5);let a=r(n?0:s.getUTCDay(),("0"+s.getUTCHours()).slice(-2)+("0"+s.getUTCMinutes()).slice(-2));return Object.entries(t).forEach((t=>{let[n,s]=t;try{o[n].forEach(((e,t)=>{e&&Object.entries(s).forEach((e=>{let[n,o]=e,s=r(t,n),l=r(t,o?o[0]:n);var c,u,d;i=i||(u=l,(c=s)-60<=(d=a)&&d<=u+60||c-60<=d+10080&&d+10080<=u+60)}))}))}catch(l){console.log(e+" has unknown service ID"),i=!0}})),i}},7822:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var o=r(n(5045)),i=n(6417),s=(0,o.default)((0,i.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");t.Z=s},6584:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(1171),o=n(6417);const i=(0,r.Z)((0,o.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star")},2061:(e,t,n)=>{var r="Expected a function",o=NaN,i="[object Symbol]",s=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt,d="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,p="object"==typeof self&&self&&self.Object===Object&&self,f=d||p||Function("return this")(),x=Object.prototype.toString,h=Math.max,g=Math.min,m=function(){return f.Date.now()};function b(e,t,n){var o,i,s,a,l,c,u=0,d=!1,p=!1,f=!0;if("function"!=typeof e)throw new TypeError(r);function x(t){var n=o,r=i;return o=i=void 0,u=t,a=e.apply(r,n)}function b(e){var n=e-c;return void 0===c||n>=t||n<0||p&&e-u>=s}function y(){var e=m();if(b(e))return Z(e);l=setTimeout(y,function(e){var n=t-(e-c);return p?g(n,s-(e-u)):n}(e))}function Z(e){return l=void 0,f&&o?x(e):(o=i=void 0,a)}function T(){var e=m(),n=b(e);if(o=arguments,i=this,c=e,n){if(void 0===l)return function(e){return u=e,l=setTimeout(y,t),d?x(e):a}(c);if(p)return l=setTimeout(y,t),x(c)}return void 0===l&&(l=setTimeout(y,t)),a}return t=j(t)||0,v(n)&&(d=!!n.leading,s=(p="maxWait"in n)?h(j(n.maxWait)||0,t):s,f="trailing"in n?!!n.trailing:f),T.cancel=function(){void 0!==l&&clearTimeout(l),u=0,o=c=i=l=void 0},T.flush=function(){return void 0===l?a:Z(m())},T}function v(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function j(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&x.call(e)==i}(e))return o;if(v(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=v(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var n=l.test(e);return n||c.test(e)?u(e.slice(2),n?2:8):a.test(e)?o:+e}e.exports=function(e,t,n){var o=!0,i=!0;if("function"!=typeof e)throw new TypeError(r);return v(n)&&(o="leading"in n?!!n.leading:o,i="trailing"in n?!!n.trailing:i),b(e,t,{leading:o,maxWait:t,trailing:i})}}}]);